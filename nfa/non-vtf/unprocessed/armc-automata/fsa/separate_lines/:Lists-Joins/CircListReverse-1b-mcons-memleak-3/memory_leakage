We consider:
  - 4 variables: l,x,y,z
  - 3 markers: m_f-m_t, n_f-n_t, o_f-o_t

WRT version 1 augmented by testing a need for further reachability checkening before actually doing it...
WRT version 2, the testing is done before a next step, not after the previous step...

==================================================================================

Phase 1 -- marking elements directly reachable via l,x,y,z
           and detection of clearly unreachable elements

{[n:ph1,? :lx1,(~'|'& ?)*,
  {['|',[]:r,(~ / & ?)*,{l,x,y,z},(~ / & ?)*,[/,[]:r,(~{/,'|'}& ?)*]*],
   ['|',(~{/,l,x,y,z}& ?)*,{m_t,n_t,o_t},(~{/,l,x,y,z}& ?)*,/,(~'|'& ?)*]}*,
  '|'],
 [n:e, ? *,'|',(~{/,l,x,y,z,m_t,n_t,o_t}& ?)*,/, ? * ]}

==================================================================================

Phase 2 -- marking elements via markers m_f/m_t, n_f/n_t, o_f/o_t

1. repetition:

[? *,'|',{[~{r,m_t,n_t,o_t}& ?,(~{'|',/}& ?)*,{m_t,n_t,o_t},? *],[{m_t,n_t,o_t},? *]}] o
{{[ph1:ph21,lx1:lx21,? *,'|',[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,m_f,? *],
  [ph1:ph21,lx1:lx21,? *,'|',[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, m_f, ? *],
  [ph1:ph21,lx1:lx21,? *, r, (~{'|',/} & ?)*, m_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
 {[ph1:ph21,lx1:lx21,? *,'|',[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,n_f,? *],
  [ph1:ph21,lx1:lx21,? *,'|',[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, n_f, ? *],
  [ph1:ph21,lx1:lx21,? *, r, (~{'|',/} & ?)*, n_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
 {[ph1:ph21,lx1:lx21,? *,'|',[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,o_f,? *],
  [ph1:ph21,lx1:lx21,? *,'|',[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, o_f, ? *],
  [ph1:ph21,lx1:lx21,? *, r, (~{'|',/} & ?)*, o_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
[ph1:e,lx1,
  ([? *,{/,'|'},{m_f,[~r & ?,(~{'|',/} & ?)*,m_f]},? * ] &
   [? *,{/,'|'},{n_f,[~r & ?,(~{'|',/} & ?)*,n_f]},? * ] &
   [? *,{/,'|'},{o_f,[~r & ?,(~{'|',/} & ?)*,o_f]},? * ])]}

----------------------------------------------------------------------------------

2. repetition:

[ph21, ? *,'|',{[~{r,m_t,n_t,o_t}& ?,(~{'|',/}& ?)*,{m_t,n_t,o_t},? *],[{m_t,n_t,o_t},? *]}] o
{{[ph21:ph22,lx21:lx22,? *,'|',[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,m_f,? *],
  [ph21:ph22,lx21:lx22,? *,'|',[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, m_f, ? *],
  [ph21:ph22,lx21:lx22,? *, r, (~{'|',/} & ?)*, m_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
 {[ph21:ph22,lx21:lx22,? *,'|',[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,n_f,? *],
  [ph21:ph22,lx21:lx22,? *,'|',[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, n_f, ? *],
  [ph21:ph22,lx21:lx22,? *, r, (~{'|',/} & ?)*, n_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
 {[ph21:ph22,lx21:lx22,? *,'|',[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,o_f,? *],
  [ph21:ph22,lx21:lx22,? *,'|',[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, o_f, ? *],
  [ph21:ph22,lx21:lx22,? *, r, (~{'|',/} & ?)*, o_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
 [ph21:e,lx21,
  ([? *,{/,'|'},{m_f,[~r & ?,(~{'|',/} & ?)*,m_f]},? * ] &
   [? *,{/,'|'},{n_f,[~r & ?,(~{'|',/} & ?)*,n_f]},? * ] &
   [? *,{/,'|'},{o_f,[~r & ?,(~{'|',/} & ?)*,o_f]},? * ])]}

----------------------------------------------------------------------------------

3. repetition:

[ph22, ? *,'|',{[~{r,m_t,n_t,o_t}& ?,(~{'|',/}& ?)*,{m_t,n_t,o_t},? *],[{m_t,n_t,o_t},? *]}] o
{{[ph22:ph3,lx22:lx3,? *,'|',[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,m_f,? *],
  [ph22:ph3,lx22:lx3,? *,'|',[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, m_f, ? *],
  [ph22:ph3,lx22:lx3,? *, r, (~{'|',/} & ?)*, m_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,m_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
 {[ph22:ph3,lx22:lx3,? *,'|',[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,n_f,? *],
  [ph22:ph3,lx22:lx3,? *,'|',[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, n_f, ? *],
  [ph22:ph3,lx22:lx3,? *, r, (~{'|',/} & ?)*, n_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,n_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
 {[ph22:ph3,lx22:lx3,? *,'|',[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]+,o_f,? *],
  [ph22:ph3,lx22:lx3,? *,'|',[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,[/,r,(~{/,'|'}& ?)*]*,'|',
    ? *, r, (~ '|' & ?)*, o_f, ? *],
  [ph22:ph3,lx22:lx3,? *, r, (~{'|',/} & ?)*, o_f, ? *,{'|',/},[]:r,(~{r,/,'|'}& ?)*,o_t,(~ / & ?)*,[/,[]:r,(~{r,/,'|'}& ?)*]*,
    [/,r,(~{/,'|'}& ?)*]*,'|',? * ]},
[ph22:e,lx22,
  ([? *,{/,'|'},{m_f,[~r & ?,(~{'|',/} & ?)*,m_f]},? * ] &
   [? *,{/,'|'},{n_f,[~r & ?,(~{'|',/} & ?)*,n_f]},? * ] &
   [? *,{/,'|'},{o_f,[~r & ?,(~{'|',/} & ?)*,o_f]},? * ])]}

==================================================================================

Phase 3 -- finally detecting unreachable loops (markers: m_f/m_t, n_f/n_t, o_f/o_t)

[ph3:e,lx3,? *,'|',{[~{r,m_t,n_t,o_t}& ?,(~{'|',/}& ?)*,{m_t,n_t,o_t},? *],[{m_t,n_t,o_t},? *]}]

==================================================================================

